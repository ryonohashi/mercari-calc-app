# メルカリ利益計算ツール 実装計画書

## 1. プロジェクト概要
Vite + React (TypeScript) を使用したメルカリ出品者のための利益計算Webツール。

## 2. 技術スタック
- **Framework:** Vite + React 19.2.0
- **Language:** TypeScript 5.9.3
- **Styling:** Tailwind CSS
- **Icon Library:** Lucide React
- **State Management:** React Hooks (useState)

## 3. 依存関係の追加

### 必要なパッケージ
```json
{
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "lucide-react": "^0.x.x"
  },
  "devDependencies": {
    "tailwindcss": "^3.x.x",
    "postcss": "^8.x.x",
    "autoprefixer": "^10.x.x"
  }
}
```

### インストールコマンド
```bash
npm install lucide-react
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
```

## 4. プロジェクト構成

```
merukari-app/
├── src/
│   ├── components/
│   │   ├── Header.tsx          # ヘッダーコンポーネント
│   │   ├── ProfitCalculator.tsx # メイン計算フォーム
│   │   ├── ResultDisplay.tsx   # 結果表示コンポーネント
│   │   ├── ReverseCalculator.tsx # 逆算機能コンポーネント
│   │   └── Footer.tsx          # フッターコンポーネント
│   ├── types/
│   │   └── index.ts            # TypeScript型定義
│   ├── utils/
│   │   └── calculations.ts     # 計算ロジック
│   ├── constants/
│   │   └── shipping.ts         # 配送方法プリセットデータ
│   ├── App.tsx                 # メインアプリケーション
│   ├── main.tsx                # エントリーポイント
│   └── index.css               # グローバルスタイル（Tailwind含む）
├── public/
├── package.json
├── tsconfig.json
├── vite.config.ts
├── tailwind.config.js
└── postcss.config.js
```

## 5. 型定義設計

### `src/types/index.ts`
```typescript
// 配送方法の型定義
export type ShippingMethod = {
  id: string;
  name: string;
  shippingFee: number;  // 送料
  boxFee: number;       // 箱代/シール代
};

// 計算結果の型定義
export type CalculationResult = {
  sellingPrice: number;      // 販売価格
  commission: number;         // 販売手数料
  totalShipping: number;      // 送料合計
  purchasePrice: number;      // 仕入れ値
  packagingCost: number;      // 梱包資材費
  profit: number;             // 販売利益
  profitRate: number;         // 利益率 (%)
};
```

## 6. 定数定義

### `src/constants/shipping.ts`
```typescript
import { ShippingMethod } from '../types';

export const SHIPPING_METHODS: ShippingMethod[] = [
  { id: 'yuupacket-mini', name: 'ゆうパケットポストmini', shippingFee: 160, boxFee: 20 },
  { id: 'nekopos', name: 'ネコポス', shippingFee: 210, boxFee: 0 },
  { id: 'yuupacket-post', name: 'ゆうパケットポスト', shippingFee: 215, boxFee: 5 },
  { id: 'takkyubin-compact', name: '宅急便コンパクト', shippingFee: 450, boxFee: 70 },
  { id: 'yuupacket-plus', name: 'ゆうパケットプラス', shippingFee: 455, boxFee: 65 },
  { id: 'takkyubin-60', name: '宅急便 60サイズ', shippingFee: 750, boxFee: 0 },
  { id: 'other', name: 'その他 (手入力)', shippingFee: 0, boxFee: 0 },
];

export const MIN_SELLING_PRICE = 300;
export const MAX_SELLING_PRICE = 9999999;
export const COMMISSION_RATE = 0.1; // 10%
```

## 7. 計算ロジック

### `src/utils/calculations.ts`
```typescript
import { ShippingMethod, CalculationResult } from '../types';
import { COMMISSION_RATE } from '../constants/shipping';

/**
 * 販売手数料を計算（小数点以下切り捨て）
 */
export const calculateCommission = (sellingPrice: number): number => {
  return Math.floor(sellingPrice * COMMISSION_RATE);
};

/**
 * 送料合計を計算
 */
export const calculateTotalShipping = (
  shippingMethod: ShippingMethod,
  customShippingFee?: number
): number => {
  if (shippingMethod.id === 'other' && customShippingFee !== undefined) {
    return customShippingFee;
  }
  return shippingMethod.shippingFee + shippingMethod.boxFee;
};

/**
 * 販売利益を計算
 */
export const calculateProfit = (
  sellingPrice: number,
  commission: number,
  totalShipping: number,
  purchasePrice: number,
  packagingCost: number
): number => {
  return sellingPrice - commission - totalShipping - purchasePrice - packagingCost;
};

/**
 * 利益率を計算
 */
export const calculateProfitRate = (profit: number, sellingPrice: number): number => {
  if (sellingPrice === 0) return 0;
  return (profit / sellingPrice) * 100;
};

/**
 * 目標利益から必要な販売価格を逆算
 */
export const calculateRequiredPrice = (
  targetProfit: number,
  totalShipping: number,
  purchasePrice: number,
  packagingCost: number
): number => {
  return Math.ceil((targetProfit + totalShipping + purchasePrice + packagingCost) / 0.9);
};

/**
 * 完全な計算結果を生成
 */
export const calculateAll = (
  sellingPrice: number,
  shippingMethod: ShippingMethod,
  purchasePrice: number,
  packagingCost: number,
  customShippingFee?: number
): CalculationResult => {
  const commission = calculateCommission(sellingPrice);
  const totalShipping = calculateTotalShipping(shippingMethod, customShippingFee);
  const profit = calculateProfit(sellingPrice, commission, totalShipping, purchasePrice, packagingCost);
  const profitRate = calculateProfitRate(profit, sellingPrice);

  return {
    sellingPrice,
    commission,
    totalShipping,
    purchasePrice,
    packagingCost,
    profit,
    profitRate,
  };
};
```

## 8. コンポーネント設計

### 8.1 Header コンポーネント
- **役割:** アプリケーションのタイトルとアイコンを表示
- **Props:** なし
- **使用アイコン:** `Calculator` (lucide-react)

### 8.2 ProfitCalculator コンポーネント
- **役割:** メインの計算フォーム
- **State:**
  - `sellingPrice`: number (販売価格)
  - `selectedShipping`: ShippingMethod (選択された配送方法)
  - `customShippingFee`: number | undefined (その他の送料)
  - `purchasePrice`: number (仕入れ値)
  - `packagingCost`: number (梱包資材費)
- **Props:** 
  - `onCalculate`: (result: CalculationResult) => void
- **機能:**
  - リアルタイムで計算結果を親コンポーネントに通知
  - 入力値のバリデーション（販売価格: 300〜9,999,999円）

### 8.3 ResultDisplay コンポーネント
- **役割:** 計算結果の表示
- **Props:**
  - `result`: CalculationResult | null
- **機能:**
  - 利益額を大きく太字で表示
  - 利益率に応じて色を変化（0%未満: 赤、15%以上: 緑、その他: デフォルト）
  - 手数料と送料の内訳を表示

### 8.4 ReverseCalculator コンポーネント
- **役割:** 目標利益からの逆算機能
- **State:**
  - `targetProfit`: number (目標利益)
- **Props:**
  - `shippingMethod`: ShippingMethod
  - `customShippingFee`: number | undefined
  - `purchasePrice`: number
  - `packagingCost`: number
- **機能:**
  - 目標利益を入力すると、必要な販売価格を自動算出・表示

### 8.5 Footer コンポーネント
- **役割:** 注釈を表示
- **Props:** なし

## 9. スタイリング方針

### 9.1 Tailwind CSS設定
- **メインカラー:** メルカリレッド `#ff0021`
- **背景色:** 薄いグレー `#f8f9fa`
- **カード:** 白背景、影付き、角丸

### 9.2 カラーパレット
```javascript
// tailwind.config.js
colors: {
  'mercari-red': '#ff0021',
  'bg-light': '#f8f9fa',
}
```

### 9.3 レスポンシブデザイン
- モバイルファースト設計
- 最大幅: 768px (md) で中央配置
- パディング: モバイル 16px、デスクトップ 24px

### 9.4 利益率による色分け
- **利益率 < 0%:** `text-red-600` (赤字)
- **利益率 >= 20%:** `text-green-600` (緑色)
- **その他:** `text-gray-700` (デフォルト)

## 10. 実装手順

### Phase 1: プロジェクトセットアップ
1. ✅ Vite + React (TypeScript) プロジェクト確認
2. Tailwind CSS のインストールと設定
3. Lucide React のインストール
4. プロジェクト構成の作成（ディレクトリ構造）

### Phase 2: 型定義と定数
1. `src/types/index.ts` の作成
2. `src/constants/shipping.ts` の作成
3. `src/utils/calculations.ts` の作成とテスト

### Phase 3: UIコンポーネント実装
1. `Header.tsx` の実装
2. `Footer.tsx` の実装
3. `ProfitCalculator.tsx` の実装
4. `ResultDisplay.tsx` の実装
5. `ReverseCalculator.tsx` の実装

### Phase 4: メインアプリケーション統合
1. `App.tsx` で全コンポーネントを統合
2. 状態管理の実装
3. リアルタイム計算の実装

### Phase 5: スタイリング
1. Tailwind CSS の設定
2. カラーパレットの適用
3. レスポンシブデザインの調整
4. アニメーション・トランジションの追加（オプション）

### Phase 6: テストと最適化
1. 計算ロジックのテスト
2. 入力バリデーションの確認
3. パフォーマンス最適化
4. アクセシビリティの確認

## 11. 入力バリデーション

### 販売価格
- **最小値:** 300円
- **最大値:** 9,999,999円
- **型:** 整数のみ（小数点不可）

### その他の入力
- **仕入れ値:** 0円以上
- **梱包資材費:** 0円以上
- **その他送料:** 0円以上（配送方法が「その他」の場合のみ有効）

## 12. パフォーマンス考慮事項

1. **リアルタイム計算:**
   - `useMemo` を使用して計算結果をメモ化
   - 入力値が変更されたときのみ再計算

2. **レンダリング最適化:**
   - コンポーネントの適切な分割
   - `React.memo` の使用を検討（必要に応じて）

## 13. アクセシビリティ

1. **フォーム要素:**
   - 適切な `label` の使用
   - `aria-label` の追加（必要に応じて）

2. **キーボード操作:**
   - すべての入力フィールドがタブで移動可能
   - Enterキーでの送信（必要に応じて）

3. **色のコントラスト:**
   - WCAG AA 基準を満たすコントラスト比の確保

## 14. 今後の拡張可能性

1. **ローカルストレージ:**
   - 入力値の保存・復元機能

2. **計算履歴:**
   - 過去の計算結果の保存・表示

3. **エクスポート機能:**
   - CSV/PDF での計算結果のエクスポート

4. **複数商品の一括計算:**
   - 複数商品の利益を一括で計算

## 15. 実装チェックリスト

- [ ] プロジェクトセットアップ（Tailwind CSS、Lucide React）
- [ ] 型定義の作成
- [ ] 定数・計算ロジックの実装
- [ ] Header コンポーネント
- [ ] Footer コンポーネント
- [ ] ProfitCalculator コンポーネント
- [ ] ResultDisplay コンポーネント
- [ ] ReverseCalculator コンポーネント
- [ ] App.tsx での統合
- [ ] スタイリング（Tailwind CSS）
- [ ] 入力バリデーション
- [ ] レスポンシブデザイン
- [ ] テスト・動作確認

---

**作成日:** 2024年
**バージョン:** 1.0.0

